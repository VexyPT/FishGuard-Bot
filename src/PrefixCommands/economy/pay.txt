const { EmbedBuilder } = require("discord.js");

module.exports = {
    name: "pay",
    description: "Send money to another user",
    run: async(client, message) => {

        const sendUser = await client.userDB.findOne({ _id: message.author.id })
         || await client.userDB.create({ _id: message.author.id });

        const reciveUserMention = // args 1

        const reciveUser = await client.userDB.findOne({ _id: reciveUserMention.id })
         || await client.userDB.create({ _id: reciveUserMention.id });

        const moneyAmount = // args 2

        const embedConfirm = new EmbedBuilder()
        .setColor(`${client.color.green}`);

        const embedReject = new EmbedBuilder()
        .setColor(`${client.color.red}`);

        if (reciveUserMention == sendUser) {

            embedReject.setDescription(`> Sorry! you can't send money to yourself`)

            return message.reply({
                embeds: [embedReject]
            });
        }

        if(sendUser.money < moneyAmount) {

            embedReject.setDescription(`> You don't have enough money to complete this transaction, you need another ${moneyAmount - sendUser.money} ${client.emoji.coin}`)

            return message.reply({
                embeds: [embedReject]
            });
        }

        await client.userDB.updateOne({ _id: message.author.id }, {
            $inc: {
                money: - moneyAmount
            }
        }).then(async() => {
            await client.userDB.updateOne({ _id: reciveUserMention.id }, {
                $inc: {
                    money: moneyAmount
                }
            });
        });

        embedConfirm.setDescription(`> You have successfully sent ${moneyAmount} ${client.emoji.coin} to ${reciveUserMention}`)

        await message.reply({
            embeds: [embedConfirm]
        });

    }
}